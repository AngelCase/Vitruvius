1 イントロダクション
従来のシスアドのアプローチでは、複雑なコンピューティングシステムを動作させるために、開発チームと運用チームを別々にする。
この方法のメリットは、業界において既に受け入れられており、既存のツールやサービスを利用できる点。
この方法のデメリットは、サービスの巨大化に伴ってチームにかかるコストも大きくなる点と、開発と運用でチームが分かれているせいで様々な齟齬が生じてしまう点。

この問題に対してGoogleは、シスアドが手作業で行っていた作業を遂行するシステムをエンジニアに作らせた。
SREとは、ソフトウェアエンジニアに運用チームの設計を依頼したときに出来上がるもの。Googleにおいて、エンジニアに運用をやらせようとした結果、彼らは手作業でタスクをこなすことにすぐに飽きてしまい、それらの作業を代替するようなソフトウェアを作るチームができた。
SREチームはエンジニアリングに注力することが重要であるため、Googleでは運用業務の割合を50%以下にするよう上限を設けた。これを超えた場合、開発チームに超過した分の運用作業を差し戻す。

SREチームは、サービスの可用性、レイテンシ、パフォーマンス、効率性、変更管理、モニタリング、緊急対応、キャパシティプランニングに責任を負う。

開発チームとSREチームは、それぞれ新機能が追加とプロダクトを安定させるという異なる目標を持つため、構造的に対立するが、この対立はエラーバジェットの導入によって解決した。
エラーバジェットは、「信頼性100%を目標とすることが基本的に間違っている」と言う所見から生じたものである。サービスの可用性の目標が99.99%ならば、0.01%はユーザが利用できなくても許容される。これがエラーバジェットである。
開発チームとSREチームは、このエラーバジェットを使って、機能のリリース速度を最大化することを目標とする。

モニタリングの方針は十分に検討して構築する必要がある。これまで一般的だったアプローチは、特定の値や条件を監視し、閾値を超えた良い条件が満たされた場合に、メールのアラートを発するようなもの。しかし、このように人間がメールを読んで対応アクションの必要性を判断しなければならないようなシステムは根本的に欠点を抱えている。人間の代わりにソフトウェアが解釈を行い、人間はアクションが必要な時のみ通知を受けるようになっているべき。
効果的なモニタリングの出力には3つの種類がある。アラートは、人間が即座にアクションを起こす必要があることを知らせる。チケットは、即時ではないが、人間がアクションを起こす必要があることを知らせる。ログは、人間が見る必要がなく、診断や証拠を残すために記録されるものであり、何か起きない限り読む必要は無い。

人間が介入する必要がある緊急事態の場合、ベストプラクティスを事前に手順書に記録しておくことでより短い時間で復旧できる。

サービスの障害の70%は動作中のシステムの変更によって生じている。この領域におけるベストプラクティスは、自動化によって以下を実現すること。
・漸進的なロールアウトの実装(少しずつ段階的にリリースする)
・スピーディーで正確な問題の検出
・問題が起きたときの安全なロールバック

需要予測とキャパシティプランニングは、予想されている未来の需要に対して必要な可用性を提供できる十分なキャパシティーと冗長性を保障すること。
キャパシティプランニングには、これらのステップが必須。
・自然に発生する需要の正確な予測
・突発的な需要の発生源を考慮すること
・計算リソースのキャパシティとサービスのキャパシティの関連を把握するための、定期的なシステムの負荷テスト

100%の信頼性を持つサービスは目指さない。必要以上に信頼性を高めようとしすぎると、コストがかかりすぎる。

3 リスクの受容
エラーバジェットを活用することで、SREとプロダクト開発者の間で方向性を一致させることができる。エラーバジェットが余っていればリスクを取ったプッシュができるし、逆に足りなければリスクを下げるようにテストを増やすなどの行動が取れる。

4 サービスレベル目標
SLIはサービスレベル指標。よくSLIに使われるのはリクエストのレイテンシ(レスポンスを返すまでにかかった時間)、エラー率やシステムスループット、可用性など。

SLOはサービスレベル目標。これはSLIで計測されるサービスレベルの目標値である。

SLAはサービスレベルアグリーメント。ユーザとのあいだで結ばれる明示的、あるいは暗黙の契約である。SLAには、SLOを満たした場合、または満たせなかった場合に関するルールが含まれ、たとえば払い戻しやペナルティなどがある。

5 トイルの撲滅
トイルとは、サービス稼働のために手作業で繰り返し行われ、自動化可能で、戦術的で長期的な価値を持たず、作業量がサービスの成長に比例する性質をもつ作業。

トイルは少量であるうちは良い。トイルが有害になるのは大量になったとき。そうなると、キャリアアップの阻害や士気の低下、生産性の低下、いざこざの発生などを生む。

6 分散システムのモニタリング
システムが自身を自動修復できないのでなく、単に「何か少しおかしい」といったことではアラートを発してはならない。余計なアラートはノイズとなり、従業員はノイズに隠れた本当の問題を無視してしまうことがある。

モニタリングにおける4大シグナルはレイテンシ、トラフィック、エラー、サチュレーション。レイテンシはリクエストを処理してレスポンスを返すまでの時間、トラフィックはシステムに対するリクエストの量。サチュレーションはサービスがどれだけ手一杯になっているか。

12 効果的なトラブルシューティング
問題が起きた時、まずすべきは出血を止めること。いきなり根本原因を探しに行ってはいけない。

何かを実験したとき、その結果が期待したものではなかったとしても、それは記録し、公開すべきである。他の誰かや未来の自分がそれを見ることで、同じ過ちを繰り返さずに済む。

13 緊急対応
💡この章ににおいて障害のエピソードの構成は次のようになっている：「障害の詳細」「対応」「うまくいったこと」「学んだこと」

14 インシデント管理
インシデントが起きたら、インシデントに対応するための責任分担をはっきり分けることで、みんなが自律的に動ける。
作るべき役割は次の通り。インシデント指揮者、実行作業担当、コミニケーション担当、計画担当。コミュニケーション担当は、ステークホルダーなどに定期的に最新情報を発行し、インシデントに関するドキュメントの最新化も受け持つ。計画担当者は、バグの登録や夕食の発注、引き継ぎの調整などの長期的なタスクを扱いチームを支援する。

インシデント管理のためのベストプラクティスは次の通り。
・優先順位、まず、出欠を止め、次にサービスを回復し、その後根本原因の証拠を保存する。
・準備、インシデント管理の手順を事前に用意してドキュメント化しておく。
・信頼、インシデントに関わる全員に、割り当てられた役割の中で完全な自律性を持ってもらう。
・自己観察、対応中の自分の感情に注意を払う。パニックになってきたらもっと助けを求める。
・代案の検討、今やっていることが本当に正しいのか、別の筋道を取るべきなのかを評価し直す。
・訓練、インシデントレスポンスのプロセスを定期的に利用して、しっかりと身に付けるようにする。
・持ち回り、毎回違う役割を担当する。すべてのチームメンバーがすべての役割に慣れておくようにする。

15 ポストモーテムの文化：失敗からの学び
ポストモーテムは、インシデントとそのインパクト、その解決のために行われたアクション、根本原因、再発を避けるためのフォローアップのアクションを記録するために書かれるもの。

ポストモーテムを書くのは、処罰ではなく会社全体としての学びの機会である。ポストモーテムを書くのは、時間や労力の面でコストがかかることのため、書くかどうかは慎重に判断する。
一般的には、以下のような場合に作成する。
・ユーザに影響が及んだダウンタイムやデグレーションが閾値を超えた場合
・種類の如何を問わず、データの損失が生じた場合
・オンコールエンジニアの介入が必要だった場合
・解決までの時間が閾値を超えた場合
・モニタリングの障害

20 データセンターでのロードバランシング
ロードバランシングの方式できわめて効果的だったのは重み付きラウンドロビン。
クライアントはリクエストを送る際、バックエンドの処理能力を考慮する。
この方式はうまく働き、利用率の最も低いタスクと最も高いタスクの差を大きく縮めた。

26 データの完全性：What You Read Is What You Wrote
バックアップをやるなら、重視すべきはデータのリカバリ。
バックアップが必要なのではなく、人々が本当に求めているのはリストア。
バックアップとアーカイブの最も重要な違いは、バックアップはアプリケーションにロードして戻せるものの、アーカイブは戻せないこと。

データはさまざまな障害で失われるので、これだけやっておけばいいという保護方法はない。多層的な防御が必要。
最初の防衛線は論理削除。
第二の防衛線はリカバリとバックアップ。おすすめは階層化されたバックアップ戦略。まず稼働中のデータのすぐそばで高速にリストアできるようにしておく。次にランダムアクセス可能な分散ファイルシステム。ここのリストアは多少遅くて良い。最後にテープライブラリなどのデータセンターレベルの障害に強いストレージ。
第三の防衛線は異常の早期検出。

データリカバリがうまくいくことを確認するのが大事。リカバリ自体が壊れていたら緊急時に破滅的な目に遭う。リカバリのテストを用意しておき、それを自動実行できるようにする。そして、自信を持てるくらい継続的にテストを実行する。

28 SREの成長を加速する方法：新人からオンコール担当、そしてその先へ
新規SREメンバーの教育では、いきなり現場に持ち込むというのがありふれたやり方だが、推奨されない。
概念の勉強と実践をちょうど良いバランスでやらせるのがよい。

29 割り込みへの対処
最大限の生産性を保つために、コンテキストスイッチを最小化する。プロジェクトの作業時を行う時間、割り込み対応だけを行う時間を二極化させる。

32 進化するSREのエンゲージメントモデル
ダークローンチ
ユーザーからのトラフィックを動作中のサービスだけでなく、新しいサービスにも送るやり方。新しいサービスからのレスポンスは破棄されるため、ダークと呼ばれる。